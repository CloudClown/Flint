/**
 * Module dependencies.
 */

var express = require('express');
var routes = require('./routes');
var http = require('http');
var path = require('path');
var sass = require('node-sass');
var app = express();

/* code for getting access token and setting conditions on Isaacloud */
process.env['NODE_TLS_REJECT_UNAUTHORIZED'] = '0';
var request = require('request');
var auth = 'Basic NjE6YzVlMzMwOWVjNGEyNzIzZDUzZjhjNmExODVlMmMz';
var options = {
  method: 'POST',
  uri: 'https://oauth.isaacloud.com/token',
  form: {
    grant_type: 'client_credentials'
  },
  headers: {
    'Authorization': auth
  }
};
request(options, function (error, response, body) {
  console.log(body);
});

var auth2 = 'Bearer ' + new Buffer('a4da88a48f8cb5d431de9a4ee0cf3962').toString('base64');
var options2 = {
  uri : 'https://api.isaacloud.com/v1/cache/users',
  method: 'GET', 
  headers: {
    'Authorization': auth2
  }
}
request(options2, function (error, response, body) {
  console.log(response + body);
});
// all environments
app.set('port', process.env.PORT || 3000);
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'jade');
app.use(express.favicon());
app.use(express.logger('dev'));
app.use(express.json());
app.use(express.urlencoded());
app.use(express.methodOverride());
app.use(express.cookieParser('your secret here'));
app.use(express.session());
app.use(app.router);

app.use(
        sass.middleware({
            src: __dirname + '/public', //where the sass files are
            dest: __dirname + '/public', //where css should go
            debug: true // obvious
        })
       );

app.use(express.static(path.join(__dirname, 'public')));

// development only
if ('development' === app.get('env')) {
    app.use(express.errorHandler());
    app.locals.pretty = true;
}

app.get('/', routes.index);

http.createServer(app).listen(app.get('port'), function(){
    console.log('Express server listening on port ' + app.get('port'));
});
